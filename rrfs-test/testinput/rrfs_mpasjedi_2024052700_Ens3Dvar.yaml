_member: &memberConfig
  date: &analysisDate '2024-05-27T00:00:00Z'
  state variables: &incvars [spechum,surface_pressure,temperature,uReconstructMeridional,uReconstructZonal]
  stream name: ensemble

output:
  filename: ./ana.$Y-$M-$D_$h.$m.$s.nc
  stream name: analysis
variational:
  minimizer:
    algorithm: DRPCG
  iterations:
  - geometry:
      nml_file: ./namelist.atmosphere
      streams_file: ./streams.atmosphere
      deallocate non-da fields: true
      interpolation type: unstructured
    gradient norm reduction: 1e-3
    diagnostics:
      departures: ombg
    ninner: 50
  - geometry:
      nml_file: ./namelist.atmosphere
      streams_file: ./streams.atmosphere
      deallocate non-da fields: true
      interpolation type: unstructured
    gradient norm reduction: 1e-3
    diagnostics:
      departures: ombg
    ninner: 50
final:
  diagnostics:
    departures: oman
cost function:
  cost type: 3D-Var
  time window:
     begin: '2024-05-26T21:00:00Z'
     length: PT6H
  jb evaluation: false
  geometry:
    nml_file: ./namelist.atmosphere
    streams_file: ./streams.atmosphere
    deallocate non-da fields: true
    interpolation type: unstructured
  analysis variables: *incvars
  background:
    state variables: [spechum,surface_pressure,temperature,uReconstructMeridional,uReconstructZonal,theta,rho,u,qv,pressure,landmask,xice,snowc,skintemp,ivgtyp,isltyp,snowh,vegfra,u10,v10,lai,smois,tslb,pressure_p,qc,qi,qg,qr,qs,cldfrac]
    filename: data/mpasout.2024-05-27_00.00.00.nc
    date: *analysisDate
  background error:
    covariance model: ensemble
    localization:
      localization method: SABER
      saber central block:
        saber block name: BUMP_NICAS
        active variables: *incvars
        read:
          io:
            data directory: data/bumploc/conus12km-401km11levels
            files prefix: bumploc_401km11levels
          drivers:
            multivariate strategy: duplicated
            read local nicas: true
          model:
            level for 2d variables: last
    members from template:
      template:
        <<: *memberConfig
        filename: ./data/ens/mem%iMember%/mpasout.2024-05-27_00.00.00.nc
      pattern: "%iMember%"
      start: 1
      zero padding: 3
      nmembers: 30

  observations:
     observers:
     - obs space:
         name: aircar
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircar_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCAR_hofxs_airTemperature_133.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [airTemperature]
         simulated variables: [airTemperature]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_tsen_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: airTemperature

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # airTemperature
         # ------------------
         # Initial error assignment
         # 133
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 133
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [1.4088, 1.3361, 1.2395, 1.1379, 1.0505, 0.98154, 0.92451, 0.87349, 0.82829, 0.79582, 0.77562, 0.75911, 0.7408, 0.72571, 0.72719, 0.75204, 0.80129, 0.8696, 0.93292, 0.9672, 0.9831, 0.99132, 0.99603, 0.99854, 0.99963, 0.99997, 1.0, 0.99999, 0.99995, 0.99985, 0.99958, 0.99914, 0.99869]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: airTemperature
         #  where:
         #  - variable: ObsType/airTemperature
         #    is_in: 133
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [airTemperature]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupt.f90)
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 133
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: airTemperature
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           minvalue: 100
           maxvalue: 400

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/airTemperature
             is_in: 133
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/airTemperature
         #  - variable: ObsValue/airTemperature
         #  - variable: QCflagsData/airTemperature

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircar_geovals_rrfs.nc4
     - obs space:
         name: aircar
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircar_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCAR_hofxs_uv_233.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [windEastward, windNorthward]
         simulated variables: [windEastward, windNorthward]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           hofx_scaling: true
           hofx scaling field: wind_reduction_factor_at_10m
           hofx scaling field group: GeoVaLs
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_uv_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: windEastward
           - name: windNorthward

       linear obs operator:
          name: Identity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # windEastward
         # ------------------
         # Initial error assignment
         # 233
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 233
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windEastward
         #  where:
         #  - variable: ObsType/windEastward
         #    is_in: 233
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windEastward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 233
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windEastward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         # ------------------
         # windNorthward
         # ------------------
         # 233
         # Initial error assignment
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 233
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214, 2.3214]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windNorthward
         #  where:
         #  - variable: ObsType/windNorthward
         #    is_in: 233
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windNorthward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 233
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windNorthward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           minvalue: -200
           maxvalue: 200
           where:
           - variable: ObsType/windEastward
             is_in: 233
           action:
             name: reject

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           absolute threshold: 10.0
           threshold: 10.0
           where:
           - variable: ObsType/windEastward
             is_in: 233
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75
           where:
           - variable: ObsType/windEastward
             is_in: 233
           action:
             name: reject

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/windEastward
         #  - variable: ObsValue/windEastward
         #  - variable: ObsType/windNorthward
         #  - variable: ObsValue/windNorthward
         #  - variable: QCflagsData/windEastward
         #  - variable: QCflagsData/windNorthward

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircar_geovals_rrfs.nc4
     - obs space:
         name: aircar
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircar_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCAR_hofxs_specificHumidity_133.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [specificHumidity]
         simulated variables: [specificHumidity]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_q_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: specificHumidity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # specificHumidity
         # ------------------
         # Initial error assignment
         # 133
         - filter: Perform Action
           filter variables:
           - name: specificHumidity
           where:
           - variable: ObsType/specificHumidity
             is_in: 133
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [0.19455, 0.19064, 0.18488, 0.17877, 0.17342, 0.16976, 0.16777, 0.16696, 0.16605, 0.16522, 0.16637, 0.17086, 0.17791, 0.18492, 0.18996, 0.19294, 0.19447, 0.19597, 0.19748, 0.19866, 0.19941, 0.19979, 0.19994, 0.19999, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2] 
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: specificHumidity
         #  where:
         #  - variable: ObsType/specificHumidity
         #    is_in: 133
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [specificHumidity]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         ## error inflation based on pressure check (setupq.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: specificHumidity
         #  where:
         #  - variable: ObsType/specificHumidity
         #    is_in: 133
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorPressureCheck
         #      options:
         #        variable: specificHumidity
         #        inflation factor: 0.0
         #        #geovar_sfc_geomz: surface_geometric_height #FV3
         #        #geovar_sfc_geomz: surface_altitude #MPAS
         #        request_saturation_specific_humidity_geovals: true
         #  defer to post: true

         # Reject specificHumidity with ObsType=130,131,135
         - filter: Perform Action
           filter variables:
           - name: specificHumidity
           where:
           - variable: ObsType/specificHumidity
             is_in: 130,131,135
           action:
             name: reject
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: specificHumidity
           minvalue: 0.0
           maxvalue: 1.0

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: specificHumidity
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/specificHumidity
             is_in: 133
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/specificHumidity
         #  - variable: ObsValue/specificHumidity
         #  - variable: QCflagsData/specificHumidity

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircar_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_airTemperature_130.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [airTemperature]
         simulated variables: [airTemperature]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_tsen_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: airTemperature

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # airTemperature
         # ------------------
         # Initial error assignment
         # 130
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 130
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [2.4618, 2.4244, 2.3481, 2.2352, 2.0999, 1.9647, 1.8522, 1.7754, 1.7323, 1.7134, 1.7093, 1.7131, 1.717, 1.7061, 1.655, 1.5397, 1.3754, 1.2567, 1.2116, 1.252, 1.37, 1.501, 1.6004, 1.6588, 1.6865, 1.6969, 1.6998, 1.7001, 1.7, 1.7, 1.7003, 1.6999, 1.6956]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: airTemperature
         #  where:
         #  - variable: ObsType/airTemperature
         #    is_in: 130
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [airTemperature]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupt.f90)
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 130
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: airTemperature
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           minvalue: 100
           maxvalue: 400

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/airTemperature
             is_in: 130
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/airTemperature
         #  - variable: ObsValue/airTemperature
         #  - variable: QCflagsData/airTemperature

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_airTemperature_131.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [airTemperature]
         simulated variables: [airTemperature]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_tsen_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: airTemperature

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # airTemperature
         # ------------------
         # Initial error assignment
         # 131
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 131
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [1.3385, 1.219, 1.0515, 0.8746, 0.73725, 0.66965, 0.66362, 0.66525, 0.65262, 0.63131, 0.59435, 0.54816, 0.51139, 0.49975, 0.51952, 0.59104, 0.71862, 0.85608, 0.95397, 1.0002, 1.0124, 1.0103, 1.0055, 1.0021, 1.0005, 1.0, 0.9999, 0.99991, 0.99994, 1.0, 1.0002, 0.99994, 0.99744]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: airTemperature
         #  where:
         #  - variable: ObsType/airTemperature
         #    is_in: 131
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [airTemperature]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupt.f90)
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 131
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: airTemperature
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           minvalue: 100
           maxvalue: 400

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/airTemperature
             is_in: 131
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -1.00
               maxvalue: 1.00

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/airTemperature
         #  - variable: ObsValue/airTemperature
         #  - variable: QCflagsData/airTemperature

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_airTemperature_134.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [airTemperature]
         simulated variables: [airTemperature]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_tsen_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: airTemperature

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # airTemperature
         # ------------------
         # Initial error assignment
         # 134
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 134
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [1.3806, 1.2566, 1.1252, 1.0055, 0.90851, 0.83495, 0.78541, 0.75802, 0.7454, 0.74532, 0.76976, 0.83782, 0.95649, 1.108, 1.2625, 1.3975, 1.5033, 1.5792, 1.6299, 1.6614, 1.6799, 1.6901, 1.6953, 1.6979, 1.6991, 1.6995, 1.6997, 1.6996, 1.6993, 1.6989, 1.6984, 1.6968, 1.6914]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: airTemperature
         #  where:
         #  - variable: ObsType/airTemperature
         #    is_in: 134
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [airTemperature]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupt.f90)
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 134
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: airTemperature
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           minvalue: 100
           maxvalue: 400

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/airTemperature
             is_in: 134
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/airTemperature
         #  - variable: ObsValue/airTemperature
         #  - variable: QCflagsData/airTemperature

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_airTemperature_135.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [airTemperature]
         simulated variables: [airTemperature]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_tsen_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: airTemperature

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # airTemperature
         # ------------------
         # Initial error assignment
         # 135
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 135
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [1.4544, 1.3404, 1.23, 1.1433, 1.0834, 1.046, 1.0241, 1.0095, 0.99605, 0.97832, 0.95123, 0.91277, 0.86866, 0.83423, 0.82956, 0.86953, 0.95611, 1.078, 1.2178, 1.3527, 1.4663, 1.5524, 1.6121, 1.6506, 1.6737, 1.6866, 1.6934, 1.6967, 1.698, 1.6984, 1.6981, 1.6967, 1.6914]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: airTemperature
         #  where:
         #  - variable: ObsType/airTemperature
         #    is_in: 135
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [airTemperature]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupt.f90)
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 135
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: airTemperature
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           minvalue: 100
           maxvalue: 400

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/airTemperature
             is_in: 135
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/airTemperature
         #  - variable: ObsValue/airTemperature
         #  - variable: QCflagsData/airTemperature

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_specificHumidity_134.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [specificHumidity]
         simulated variables: [specificHumidity]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_q_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: specificHumidity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # specificHumidity
         # ------------------
         # Initial error assignment
         # 134
         - filter: Perform Action
           filter variables:
           - name: specificHumidity
           where:
           - variable: ObsType/specificHumidity
             is_in: 134
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [0.10178, 0.090966, 0.082655, 0.078617, 0.078063, 0.079308, 0.08107, 0.082841, 0.084912, 0.088692, 0.095913, 0.10801, 0.12459, 0.14281, 0.15959, 0.17319, 0.1832, 0.19002, 0.19437, 0.19699, 0.19847, 0.19926, 0.19966, 0.19985, 0.19993, 0.19996, 0.19997, 0.19995, 0.19992, 0.19988, 0.19981, 0.19963, 0.19899] 
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: specificHumidity
         #  where:
         #  - variable: ObsType/specificHumidity
         #    is_in: 134
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [specificHumidity]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         ## error inflation based on pressure check (setupq.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: specificHumidity
         #  where:
         #  - variable: ObsType/specificHumidity
         #    is_in: 134
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorPressureCheck
         #      options:
         #        variable: specificHumidity
         #        inflation factor: 0.0
         #        #geovar_sfc_geomz: surface_geometric_height #FV3
         #        #geovar_sfc_geomz: surface_altitude #MPAS
         #        request_saturation_specific_humidity_geovals: true
         #  defer to post: true

         # Reject specificHumidity with ObsType=130,131,135
         - filter: Perform Action
           filter variables:
           - name: specificHumidity
           where:
           - variable: ObsType/specificHumidity
             is_in: 130,131,135
           action:
             name: reject
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: specificHumidity
           minvalue: 0.0
           maxvalue: 1.0

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: specificHumidity
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/specificHumidity
             is_in: 134
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/specificHumidity
         #  - variable: ObsValue/specificHumidity
         #  - variable: QCflagsData/specificHumidity

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_uv_230.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [windEastward, windNorthward]
         simulated variables: [windEastward, windNorthward]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           hofx_scaling: true
           hofx scaling field: wind_reduction_factor_at_10m
           hofx scaling field group: GeoVaLs
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_uv_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: windEastward
           - name: windNorthward

       linear obs operator:
          name: Identity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # windEastward
         # ------------------
         # Initial error assignment
         # 230
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 230
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windEastward
         #  where:
         #  - variable: ObsType/windEastward
         #    is_in: 230
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windEastward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 230
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windEastward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         # ------------------
         # windNorthward
         # ------------------
         # 230
         # Initial error assignment
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 230
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951, 3.2951]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windNorthward
         #  where:
         #  - variable: ObsType/windNorthward
         #    is_in: 230
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windNorthward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 230
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windNorthward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           minvalue: -200
           maxvalue: 200
           where:
           - variable: ObsType/windEastward
             is_in: 230
           action:
             name: reject

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           absolute threshold: 10.0
           threshold: 10.0
           where:
           - variable: ObsType/windEastward
             is_in: 230
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75
           where:
           - variable: ObsType/windEastward
             is_in: 230
           action:
             name: reject

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/windEastward
         #  - variable: ObsValue/windEastward
         #  - variable: ObsType/windNorthward
         #  - variable: ObsValue/windNorthward
         #  - variable: QCflagsData/windEastward
         #  - variable: QCflagsData/windNorthward

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_uv_231.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [windEastward, windNorthward]
         simulated variables: [windEastward, windNorthward]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           hofx_scaling: true
           hofx scaling field: wind_reduction_factor_at_10m
           hofx scaling field group: GeoVaLs
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_uv_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: windEastward
           - name: windNorthward

       linear obs operator:
          name: Identity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # windEastward
         # ------------------
         # Initial error assignment
         # 231
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 231
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windEastward
         #  where:
         #  - variable: ObsType/windEastward
         #    is_in: 231
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windEastward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 231
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windEastward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         # ------------------
         # windNorthward
         # ------------------
         # 231
         # Initial error assignment
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 231
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567, 5.6567]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windNorthward
         #  where:
         #  - variable: ObsType/windNorthward
         #    is_in: 231
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windNorthward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 231
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windNorthward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           minvalue: -200
           maxvalue: 200
           where:
           - variable: ObsType/windEastward
             is_in: 231
           action:
             name: reject

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           absolute threshold: 10.0
           threshold: 10.0
           where:
           - variable: ObsType/windEastward
             is_in: 231
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -1.00
               maxvalue: 1.00
           where:
           - variable: ObsType/windEastward
             is_in: 231
           action:
             name: reject

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/windEastward
         #  - variable: ObsValue/windEastward
         #  - variable: ObsType/windNorthward
         #  - variable: ObsValue/windNorthward
         #  - variable: QCflagsData/windEastward
         #  - variable: QCflagsData/windNorthward

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_uv_234.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [windEastward, windNorthward]
         simulated variables: [windEastward, windNorthward]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           hofx_scaling: true
           hofx scaling field: wind_reduction_factor_at_10m
           hofx scaling field group: GeoVaLs
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_uv_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: windEastward
           - name: windNorthward

       linear obs operator:
          name: Identity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # windEastward
         # ------------------
         # Initial error assignment
         # 234
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 234
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [3.8901, 3.7615, 3.7452, 3.8681, 4.0863, 4.3283, 4.5455, 4.7094, 4.8036, 4.8388, 4.8463, 4.8723, 4.9327, 5.0201, 5.1193, 5.2166, 5.302, 5.3703, 5.4203, 5.454, 5.475, 5.4872, 5.4938, 5.4971, 5.4986, 5.4992, 5.4991, 5.4986, 5.4978, 5.4965, 5.4947, 5.4897, 5.472]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windEastward
         #  where:
         #  - variable: ObsType/windEastward
         #    is_in: 234
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windEastward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 234
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windEastward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         # ------------------
         # windNorthward
         # ------------------
         # 234
         # Initial error assignment
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 234
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [3.8901, 3.7615, 3.7452, 3.8681, 4.0863, 4.3283, 4.5455, 4.7094, 4.8036, 4.8388, 4.8463, 4.8723, 4.9327, 5.0201, 5.1193, 5.2166, 5.302, 5.3703, 5.4203, 5.454, 5.475, 5.4872, 5.4938, 5.4971, 5.4986, 5.4992, 5.4991, 5.4986, 5.4978, 5.4965, 5.4947, 5.4897, 5.472]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windNorthward
         #  where:
         #  - variable: ObsType/windNorthward
         #    is_in: 234
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windNorthward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 234
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windNorthward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           minvalue: -200
           maxvalue: 200
           where:
           - variable: ObsType/windEastward
             is_in: 234
           action:
             name: reject

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           absolute threshold: 10.0
           threshold: 10.0
           where:
           - variable: ObsType/windEastward
             is_in: 234
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75
           where:
           - variable: ObsType/windEastward
             is_in: 234
           action:
             name: reject

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/windEastward
         #  - variable: ObsValue/windEastward
         #  - variable: ObsType/windNorthward
         #  - variable: ObsValue/windNorthward
         #  - variable: QCflagsData/windEastward
         #  - variable: QCflagsData/windNorthward

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: aircft
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_aircft_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: AIRCFT_hofxs_uv_235.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [windEastward, windNorthward]
         simulated variables: [windEastward, windNorthward]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           hofx_scaling: true
           hofx scaling field: wind_reduction_factor_at_10m
           hofx scaling field group: GeoVaLs
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/aircraft_uv_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: windEastward
           - name: windNorthward

       linear obs operator:
          name: Identity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # windEastward
         # ------------------
         # Initial error assignment
         # 235
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 235
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [3.9845, 3.8612, 3.7929, 3.7968, 3.8561, 3.9456, 4.0321, 4.0893, 4.1115, 4.103, 4.069, 4.024, 3.9821, 3.9532, 3.9523, 4.001, 4.1203, 4.3179, 4.5673, 4.8193, 5.0368, 5.2042, 5.3219, 5.3986, 5.4452, 5.4718, 5.4858, 5.4924, 5.495, 5.4954, 5.4942, 5.4895, 5.472]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windEastward
         #  where:
         #  - variable: ObsType/windEastward
         #    is_in: 235
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windEastward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 235
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windEastward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         # ------------------
         # windNorthward
         # ------------------
         # 235
         # Initial error assignment
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 235
           action:
             name: assign error
             error function:
               name: ObsFunction/ObsErrorModelStepwiseLinear
               options:
                 xvar:
                   name: MetaData/pressure
                 xvals: [110000, 105000, 100000, 95000, 90000, 85000, 80000, 75000, 70000, 65000, 60000, 55000, 50000, 45000, 40000, 35000, 30000, 25000, 20000, 15000, 10000, 7500, 5000, 4000, 3000, 2000, 1000, 500, 400, 300, 200, 100, 0]
                 errors: [3.9845, 3.8612, 3.7929, 3.7968, 3.8561, 3.9456, 4.0321, 4.0893, 4.1115, 4.103, 4.069, 4.024, 3.9821, 3.9532, 3.9523, 4.001, 4.1203, 4.3179, 4.5673, 4.8193, 5.0368, 5.2042, 5.3219, 5.3986, 5.4452, 5.4718, 5.4858, 5.4924, 5.495, 5.4954, 5.4942, 5.4895, 5.472]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windNorthward
         #  where:
         #  - variable: ObsType/windNorthward
         #    is_in: 235
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windNorthward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 235
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windNorthward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           minvalue: -200
           maxvalue: 200
           where:
           - variable: ObsType/windEastward
             is_in: 235
           action:
             name: reject

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           absolute threshold: 10.0
           threshold: 10.0
           where:
           - variable: ObsType/windEastward
             is_in: 235
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.75
               maxvalue: 0.75
           where:
           - variable: ObsType/windEastward
             is_in: 235
           action:
             name: reject

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/windEastward
         #  - variable: ObsValue/windEastward
         #  - variable: ObsType/windNorthward
         #  - variable: ObsValue/windNorthward
         #  - variable: QCflagsData/windEastward
         #  - variable: QCflagsData/windNorthward

         #- filter: GOMsaver
         #  filename: ./data/geovals/aircft_geovals_rrfs.nc4
     - obs space:
         name: msonet
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_msonet_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: MSONET_hofxs_airTemperature_188.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [airTemperature]
         simulated variables: [airTemperature]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/sfc_tsen_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: airTemperature

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # airTemperature
         # ------------------
         # Initial error assignment
         # 188
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 188
           action:
             name: assign error
             error parameter: 4.0  # K
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: airTemperature
         #  where:
         #  - variable: ObsType/airTemperature
         #    is_in: 188
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [airTemperature]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupt.f90)
         - filter: Perform Action
           filter variables:
           - name: airTemperature
           where:
           - variable: ObsType/airTemperature
             is_in: 188
           action:
             name: inflate error
             #inflation factor: 1.09757
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: airTemperature
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           minvalue: 100
           maxvalue: 400

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: airTemperature
           absolute threshold: 5.0
           threshold: 5.0
           where:
           - variable: ObsType/airTemperature
             is_in: 188
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.10
               maxvalue: 0.10

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/airTemperature
         #  - variable: ObsValue/airTemperature
         #  - variable: QCflagsData/airTemperature

         #- filter: GOMsaver
         #  filename: ./data/geovals/msonet_geovals_rrfs.nc4
     - obs space:
         name: msonet
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_msonet_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: MSONET_hofxs_specificHumidity_188.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [specificHumidity]
         simulated variables: [specificHumidity]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/sfc_q_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: specificHumidity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # specificHumidity
         # ------------------
         # Initial error assignment
         # 188
         - filter: Perform Action
           filter variables:
           - name: specificHumidity
           where:
           - variable: ObsType/specificHumidity
             is_in: 188
           action:
             name: assign error
             error parameter: 0.07  # GSI errtable is units of RH %/10 so 0.7 --> 0.07
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: specificHumidity
         #  where:
         #  - variable: ObsType/specificHumidity
         #    is_in: 188
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [specificHumidity]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         ## error inflation based on pressure check (setupq.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: specificHumidity
         #  where:
         #  - variable: ObsType/specificHumidity
         #    is_in: 188
         #  action:
         #    name: inflate error
         #    #inflation factor: 1.7143
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorPressureCheck
         #      options:
         #        variable: specificHumidity
         #        inflation factor: 0.0
         #        #geovar_sfc_geomz: surface_geometric_height #FV3
         #        #geovar_sfc_geomz: surface_altitude #MPAS
         #        request_saturation_specific_humidity_geovals: true
         #  defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: specificHumidity
           minvalue: 0.0
           maxvalue: 1.0

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: specificHumidity
           absolute threshold: 7.0
           threshold: 7.0
           where:
           - variable: ObsType/specificHumidity
             is_in: 188
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.10
               maxvalue: 0.10

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/specificHumidity
         #  - variable: ObsValue/specificHumidity
         #  - variable: QCflagsData/specificHumidity

         #- filter: GOMsaver
         #  filename: ./data/geovals/msonet_geovals_rrfs.nc4
     - obs space:
         name: msonet
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_msonet_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: MSONET_hofxs_stationPressure_188.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [stationPressure]
         simulated variables: [stationPressure]

       obs operator:
         name: SfcPCorrected
         da_psfc_scheme: GSI
         geovar_sfc_geomz: surface_geopotential_height
         geovar_geomz: geopotential_height
       linear obs operator:
         name: Identity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # stationPressure
         # ------------------
         # Initial error assignment
         # 188
         - filter: Perform Action
           filter variables:
           - name: stationPressure
           where:
           - variable: ObsType/stationPressure
             is_in: 188
           action:
             name: assign error
             ##error parameter: 0.5389 #mb (units in GSI oberrtable)
             error parameter: 53.89 #Pa
             #error function:
             #  name: ObsFunction/ObsErrorModelStepwiseLinear
             #  options:
             #    xvar:
             #      name: ObsValue/stationPressure
             #    xvals: [60000, 59999]
             #    #errors: [53.89, 0.10000E+12]
             #    errors: [53.89, 53.89]
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: stationPressure
         #  where:
         #  - variable: ObsType/stationPressure
         #    is_in: 188
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [stationPressure]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on setupps.f90
         - filter: Perform Action
           filter variables:
           - name: stationPressure
           where:
           - variable: ObsType/stationPressure
             is_in: 188
           action:
             name: inflate error
             #inflation factor: 1.7143
             inflation variable:
               name: ObsFunction/ObsErrorFactorSfcPressure
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: stationPressure
           minvalue: 0.0
           maxvalue: 120000.0

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: stationPressure
           absolute threshold: 5.0
           threshold: 5.0
           where:
           - variable: ObsType/stationPressure
             is_in: 188
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.10
               maxvalue: 0.10

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/stationPressure
         #  - variable: ObsValue/stationPressure
         #  - variable: QCflagsData/stationPressure

         #- filter: GOMsaver
         #  filename: ./data/geovals/msonet_geovals_rrfs.nc4
     - obs space:
         name: msonet
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/ioda_msonet_dc.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: MSONET_hofxs_uv_288.nc4
             allow overwrite: true
         io pool:
           max pool size: 1
         observed variables: [windEastward, windNorthward]
         simulated variables: [windEastward, windNorthward]

       obs operator:
         name: Composite
         components:
         - name: VertInterp
           hofx_scaling: true
           hofx scaling field: wind_reduction_factor_at_10m
           hofx scaling field group: GeoVaLs
           vertical coordinate: air_pressure
           observation vertical coordinate: pressure
           observation vertical coordinate group: MetaData
           interpolation method: log-linear
           #gsi geovals:
           #  filename: "obsout/sfc_uv_geoval_2022052619.nc4"
           #  levels_are_top_down: False
           variables:
           - name: windEastward
           - name: windNorthward

       linear obs operator:
          name: Identity

       obs error:
         covariance model: diagonal

       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs filters:
         # ------------------
         # windEastward
         # ------------------
         # Initial error assignment
         # 288
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 288
           action:
             name: assign error
             error parameter: 3.0  # m/s
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windEastward
         #  where:
         #  - variable: ObsType/windEastward
         #    is_in: 288
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windEastward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windEastward
           where:
           - variable: ObsType/windEastward
             is_in: 288
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windEastward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         # ------------------
         # windNorthward
         # ------------------
         # 288
         # Initial error assignment
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 288
           action:
             name: assign error
             error parameter: 3.0  # m/s
           defer to post: true

         ## Ajusted error after initial assignment (qcmod.f90)
         #- filter: Perform Action
         #  filter variables:
         #  - name: windNorthward
         #  where:
         #  - variable: ObsType/windNorthward
         #    is_in: 288
         #  action:
         #    name: inflate error
         #    inflation variable:
         #      name: ObsFunction/ObsErrorFactorConventional
         #      options:
         #        test QCflag: PreQC
         #        test QCthreshold: 3
         #        inflate variables: [windNorthward]
         #        pressure: MetaData/pressure
         #        distance threshold: -1.
         #  defer to post: true

         # error inflation based on pressure check (setupw.f90)
         - filter: Perform Action
           filter variables:
           - name: windNorthward
           where:
           - variable: ObsType/windNorthward
             is_in: 288
           action:
             name: inflate error
             inflation variable:
               name: ObsFunction/ObsErrorFactorPressureCheck
               options:
                 variable: windNorthward
                 inflation factor: 0.0
                 #geovar_sfc_geomz: surface_geometric_height #FV3
                 #geovar_sfc_geomz: surface_altitude #MPAS
           defer to post: true

         - filter: Bounds Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           minvalue: -200
           maxvalue: 200
           where:
           - variable: ObsType/windEastward
             is_in: 288
           action:
             name: reject

         - filter: Background Check
           apply at iterations: 0,1
           filter variables:
           - name: windEastward
           - name: windNorthward
           absolute threshold: 5.0
           threshold: 5.0
           where:
           - variable: ObsType/windEastward
             is_in: 288
           action:
             name: reject

         - filter: Domain Check
           apply at iterations: 0,1
           where:
             - variable:
                 name: MetaData/timeOffset
               minvalue: -0.10
               maxvalue: 0.10
           where:
           - variable: ObsType/windEastward
             is_in: 288
           action:
             name: reject

         - filter: Temporal Thinning
           apply at iterations: 0,1
           min_spacing: PT30M
           seed_time: *analysisDate
           category_variable:
             name: MetaData/stationIdentification

         ## Print filter data
         #- filter: Print Filter Data
         #  message: Printing filter data
         #  summary: true
         #  variables:
         #  - variable: MetaData/latitude
         #  - variable: MetaData/longitude
         #  - variable: MetaData/pressure
         #  - variable: ObsType/windEastward
         #  - variable: ObsValue/windEastward
         #  - variable: ObsType/windNorthward
         #  - variable: ObsValue/windNorthward
         #  - variable: QCflagsData/windEastward
         #  - variable: QCflagsData/windNorthward

         #- filter: GOMsaver
         #  filename: ./data/geovals/msonet_geovals_rrfs.nc4
     - obs space:
         name: atms_npp
         distribution:
           name: "RoundRobin"
           halo size: 100e3
         obsdatain:
           engine:
             type: H5File
             obsfile: "data/obs_ctest/atms_npp_obs_2024052700.nc"
         obsdataout:
           engine:
             type: H5File
             obsfile: rass_atms_obs_2024052700.nc4
         simulated variables: [brightnessTemperature]
         observed variables: [brightnessTemperature]
         channels: &atms_npp_channels 1-22
       obs operator:
           name: CRTM
           Absorbers: [H2O,O3]
           SurfaceWindGeoVars: uv
           obs options:
             Sensor_ID: atms_npp
             EndianType: little_endian
             CoefficientPath: data/crtm/
             IRVISlandCoeff: IGBP
           linear obs operator:
             Absorbers: [H2O, O3]
       obs localizations:
         - localization method: Horizontal Gaspari-Cohn
           lengthscale: 300e3 # orig

       obs bias:
         input file:  data/obs_ctest/atms_npp.satbias.nc4
         output file: ./out_atms_npp.satbias.nc
         variational bc:
           predictors:
           - name: constant
           - name: lapseRate
             order: 2
             tlapse: &atms_npp_tlapse  data/obs_ctest/atms_npp.tlapse.txt
           - name: lapseRate
             tlapse: *atms_npp_tlapse
           - name: emissivityJacobian
           - name: sensorScanAngle
             order: 4
           - name: sensorScanAngle
             order: 3
           - name: sensorScanAngle
             order: 2
           - name: sensorScanAngle
         covariance:
           minimal required obs number: 20
           variance range: [1.0e-6, 10.0]
           step size: 1.0e-4
           largest analysis variance: 10000.0
           prior:
             input file: data/obs_ctest/atms_npp.satbias_cov.nc4
             inflation:
               ratio: 1.1
               ratio for small dataset: 2.0
           output file: ./out_atms_npp.satbias_cov.nc

       obs pre filters:
       # Step 0-A: Create Diagnostic Flags
       - filter: Create Diagnostic Flags
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         flags:
         - name: ScanEdgeRemoval
           initial value: false
           force reinitialization: false
         - name: Thinning
           initial value: false
           force reinitialization: false
         - name: CLWRetrievalCheck
           initial value: false
           force reinitialization: false
         - name: WindowChannelExtremeResidual
           initial value: false
           force reinitialization: false
         - name: HydrometeorCheck
           initial value: false
           force reinitialization: false
         - name: GrossCheck
           initial value: false
           force reinitialization: false
         - name: InterChannelConsistency
           initial value: false
           force reinitialization: false
         - name: UseflagCheck
           initial value: false
           force reinitialization: false

       obs post filters:
       # Step 0-B: Calculate derived variables
       # Calculate CLW retrieved from observation
       - filter: Variable Assignment
         assignments:
         - name: CLWRetFromObs@DerivedMetaData
           type: float
           function:
             name: CLWRetMW@ObsFunction
             options:
               clwret_ch238: 1
               clwret_ch314: 2
               clwret_types: [ObsValue]

       # Calculate CLW retrieved from observation
       - filter: Variable Assignment
         assignments:
         - name: CLWRetFromBkg@DerivedMetaData
           type: float
           function:
             name: CLWRetMW@ObsFunction
             options:
               clwret_ch238: 1
               clwret_ch314: 2
               clwret_types: [HofX]

       # Calculate symmetric retrieved CLW
       - filter: Variable Assignment
         assignments:
         - name: CLWRetSymmetric@DerivedMetaData
           type: float
           value: 1000.0

       - filter: Variable Assignment
         where:
         - variable:
             name: CLWRetFromObs@DerivedMetaData
           minvalue:   0.
           maxvalue: 999.
         - variable:
             name: CLWRetFromBkg@DerivedMetaData
           minvalue:   0.
           maxvalue: 999.
         where operator: and
         assignments:
         - name: CLWRetSymmetric@DerivedMetaData
           type: float
           function:
             name: Arithmetic@ObsFunction
             options:
               variables:
               - name: CLWRetFromObs@DerivedMetaData
               - name: CLWRetFromBkg@DerivedMetaData
               total coefficient: 0.5

       # Calculate scattering index from observation
       - filter: Variable Assignment
         assignments:
         - name: SIRetFromObs@DerivedMetaData
           type: float
           function:
             name: SCATRetMW@ObsFunction
             options:
               scatret_ch238: 1
               scatret_ch314: 2
               scatret_ch890: 16
               scatret_types: [ObsValue]

       # Calculate CLW obs/bkg match index
       - filter: Variable Assignment
         assignments:
         - name: CLWMatchIndex@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: CLWMatchIndexMW@ObsFunction
             channels: *atms_npp_channels
             options:
               channels: *atms_npp_channels
               clwobs_function:
                 name: CLWRetFromObs@DerivedMetaData
               clwbkg_function:
                 name: CLWRetFromBkg@DerivedMetaData
               clwret_clearsky: [ 0.030,  0.030,  0.030,  0.020,  0.030,
                                  0.080,  0.150,  0.000,  0.000,  0.000,
                                  0.000,  0.000,  0.000,  0.000,  0.000,
                                  0.020,  0.030,  0.030,  0.030,  0.030,
                                  0.050,  0.100]
       # Calculate symmetric observation error
       - filter: Variable Assignment
         assignments:
         - name: InitialObsError@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: ObsErrorModelRamp@ObsFunction
             channels: *atms_npp_channels
             options:
               channels: *atms_npp_channels
               xvar:
                 name: CLWRetSymmetric@DerivedMetaData
               x0:    [ 0.030,  0.030,  0.030,  0.020,  0.030,
                        0.080,  0.150,  0.000,  0.000,  0.000,
                        0.000,  0.000,  0.000,  0.000,  0.000,
                        0.020,  0.030,  0.030,  0.030,  0.030,
                        0.050,  0.100]
               x1:    [ 0.350,  0.380,  0.400,  0.450,  0.500,
                        1.000,  1.000,  0.000,  0.000,  0.000,
                        0.000,  0.000,  0.000,  0.000,  0.000,
                        0.350,  0.500,  0.500,  0.500,  0.500,
                        0.500,  0.500]
               err0:  [ 4.500,  4.500,  4.500,  2.500,  0.550,
                        0.300,  0.300,  0.400,  0.400,  0.400,
                        0.450,  0.450,  0.550,  0.800,  4.000,
                        4.000,  4.000,  3.500,  3.000,  3.000,
                        3.000,  3.000]
               err1:  [20.000, 25.000, 12.000,  7.000,  3.500,
                        3.000,  0.800,  0.400,  0.400,  0.400,
                        0.450,  0.450,  0.550,  0.800,  4.000,
                       19.000, 30.000, 25.000, 16.500, 12.000,
                        9.000,  6.500]

       # Calculate Innovation@DerivedMetaData
       - filter: Variable Assignment
         assignments:
         - name: Innovation@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: ObsFunction/Arithmetic
             channels: *atms_npp_channels
             options:
               variables:
               - name: brightnessTemperature@ObsValue
                 channels: *atms_npp_channels
               - name: brightnessTemperature@HofX
                 channels: *atms_npp_channels
               coefs: [1, -1]

       - filter: Bounds Check
         filter variables:
         #- name: brightnessTemperature
         - name: HofX/brightnessTemperature
           channels: *atms_npp_channels
         minvalue: 50.00001
         maxvalue: 449.99999
         action:
           name: reject

       # Regional Domain Check
       - filter: Bounds Check
         fileter variables:
         - name: brightnessTemperature
         test variables:
         - name: LAMDomainCheck@ObsFunction
           options: 
             map_projection: circle
             save: true
             cenlat: 38.5 
             cenlon: -97.5
             #radius: 1700 #km
             radius: 2500 #km
         minvalue: 1.0

       # Step 0-C: Assign Initial All-Sky Observation Error
       - filter: Perform Action
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         action:
           name: assign error
           error function:
             name: InitialObsError@DerivedMetaData
             channels: *atms_npp_channels


       # Step 1: Remove Observations from the Edge of the Scan
       - filter: Domain Check
         filter variables:
         - name: brightnessTemperature
           channels: 1-22
         where:
         - variable:
             name: MetaData/sensorScanPosition
           is_in: 7-90
         actions:
           - name: set
             flag: ScanEdgeRemoval
           - name: reject

       # Step 2: data Thinning
       - filter: Gaussian Thinning
         horizontal_mesh: 145
         use_reduced_horizontal_grid: true
         distance_norm: geodesic
       #  round_horizontal_bin_count_to_nearest: true
       #  partition_longitude_bins_using_mesh: true
         actions:
           - name: set
             flag: Thinning
           - name: reject

       # Step 3A: CLW Retrieval Check (observation_based)
       - filter: Bounds Check
         filter variables:
         - name: brightnessTemperature
           channels: 1-7, 16-22
         test variables:
         - name: CLWRetFromObs@DerivedMetaData
         maxvalue: 999.0
         actions:
           - name: set
             flag: CLWRetrievalCheck
           - name: reject

       # Step 3B: CLW Retrieval Check (background_based)
       - filter: Bounds Check
         filter variables:
         - name: brightnessTemperature
           channels: 1-7, 16-22
         test variables:
         - name: CLWRetFromBkg@DerivedMetaData
         maxvalue: 999.0
         actions:
           - name: set
             flag: CLWRetrievalCheck
           - name: reject

       # Step 4: Window Channel Sanity Check
       - filter: Bounds Check
         filter variables:
         - name: brightnessTemperature
           channels: 1-7, 16, 17-22
         test variables:
         - name: Innovation@DerivedMetaData
           channels: 1, 2, 5-7, 16
         maxvalue: 200.0
         minvalue: -200.0
         flag all filter variables if any test variable is out of bounds: true
         actions:
           - name: set
             flag: WindowChannelExtremeResidual
           - name: reject

       # Step 5: Hydrometeor Check (cloud/precipitation affected chanels)
       - filter: Variable Assignment
         assignments:
         - name: DerivedMetaData/HydrometeorCheckATMS
           channels: *atms_npp_channels
           type: float
           function:
             name: HydrometeorCheckATMS@ObsFunction
             channels: *atms_npp_channels
             options:
               channels: *atms_npp_channels
               obserr_clearsky:  [ 4.500,  4.500,  4.500,  2.500,  0.550,
                                   0.300,  0.300,  0.400,  0.400,  0.400,
                                   0.450,  0.450,  0.550,  0.800,  4.000,
                                   4.000,  4.000,  3.500,  3.000,  3.000,
                                   3.000,  3.000]
               clwret_function:
                 name: CLWRetFromObs@DerivedMetaData
               obserr_function:
                 name: InitialObsError@DerivedMetaData
                 channels: *atms_npp_channels

       - filter: Bounds Check
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         test variables:
         - name: DerivedMetaData/HydrometeorCheckATMS
           channels: *atms_npp_channels
         maxvalue: 0.0
         actions:
           - name: set
             flag: HydrometeorCheck
             ignore: rejected observations
           - name: reject

       # Step 6: Observation Error Inflation based on Topography Check
       - filter: Variable Assignment
         assignments:
         - name: ObsErrorFactorTopo@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: ObsErrorFactorTopoRad@ObsFunction
             channels: *atms_npp_channels
             options:
               sensor: atms_npp
               channels: *atms_npp_channels

       - filter: Perform Action
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         action:
           name: inflate error
           inflation variable:
             name: ObsErrorFactorTopo@DerivedMetaData
             channels: *atms_npp_channels

       # Step 7: Obs Error Inflation based on TOA Transmittancec Check
       - filter: Variable Assignment
         assignments:
         - name: ObsErrorFactorTransmitTop@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: ObsErrorFactorTransmitTopRad@ObsFunction
             channels: *atms_npp_channels
             options:
               channels: *atms_npp_channels

       - filter: Perform Action
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         action:
           name: inflate error
           inflation variable:
             name: ObsErrorFactorTransmitTop@DerivedMetaData
             channels: *atms_npp_channels

       # Step 8: Observation Error Inflation based on Surface Jacobian Check
       - filter: Variable Assignment
         assignments:
         - name: ObsErrorFactorSurfJacobian@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: ObsErrorFactorSurfJacobianRad@ObsFunction
             channels: *atms_npp_channels
             options:
               sensor: atms_npp
               channels: *atms_npp_channels
               obserr_demisf: [0.010, 0.020, 0.015, 0.020, 0.200]
               obserr_dtempf: [0.500, 2.000, 1.000, 2.000, 4.500]

       - filter: Perform Action
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         action:
           name: inflate error
           inflation variable:
             name: ObsErrorFactorSurfJacobian@DerivedMetaData
             channels: *atms_npp_channels

       # Step 9: Situation Dependent Check
       - filter: Variable Assignment
         assignments:
         - name: ObsErrorFactorSituDepend@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: ObsErrorFactorSituDependMW@ObsFunction
             channels: *atms_npp_channels
             options:
               sensor: atms_npp
               channels: *atms_npp_channels
               clwbkg_function:
                 name: CLWRetFromBkg@DerivedMetaData
               clwobs_function:
                 name: CLWRetFromObs@DerivedMetaData
               scatobs_function:
                 name: SIRetFromObs@DerivedMetaData
               clwmatchidx_function:
                 name: CLWMatchIndex@DerivedMetaData
                 channels: *atms_npp_channels
               obserr_function:
                 name: InitialObsError@DerivedMetaData
                 channels: *atms_npp_channels
               obserr_clearsky:  [ 4.500,  4.500,  4.500,  2.500,  0.550,
                                   0.300,  0.300,  0.400,  0.400,  0.400,
                                   0.450,  0.450,  0.550,  0.800,  4.000,
                                   4.000,  4.000,  3.500,  3.000,  3.000,
                                   3.000,  3.000]

       - filter: Perform Action
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         action:
           name: inflate error
           inflation variable:
             name: ObsErrorFactorSituDepend@DerivedMetaData
             channels: *atms_npp_channels
 
       # Step 10: Gross check
       # Remove data if abs(Obs-HofX) > absolute threhold
       - filter: Variable Assignment
         assignments:
         - name: ObsErrorFactorLat@DerivedMetaData
           type: float
           function:
             name: ObsErrorFactorLatRad@ObsFunction
             options:
               latitude_parameters: [25.0, 0.25, 0.04, 3.0]

       - filter: Variable Assignment
         assignments:
         - name: ObsErrorBound@DerivedMetaData
           channels: *atms_npp_channels
           type: float
           function:
             name: ObsErrorBoundMW@ObsFunction
             channels: *atms_npp_channels
             options:
               sensor: atms_npp
               channels: *atms_npp_channels
               obserr_bound_latitude:
                 name: ObsErrorFactorLat@DerivedMetaData
               obserr_bound_transmittop:
                 name: ObsErrorFactorTransmitTop@DerivedMetaData
                 channels: *atms_npp_channels
                 options:
                   channels: *atms_npp_channels
               obserr_bound_topo:
                 name: ObsErrorFactorTopo@DerivedMetaData
                 channels: *atms_npp_channels
               obserr_function:
                 name: InitialObsError@DerivedMetaData
                 channels: *atms_npp_channels
                 threhold: 3
               obserr_bound_max: [4.5, 4.5, 3.0, 3.0, 1.0,
                                  1.0, 1.0, 1.0, 1.0, 1.0,
                                  1.0, 1.0, 1.0, 2.0, 4.5,
                                  4.5, 2.0, 2.0, 2.0, 2.0,
                                  2.0, 2.0]

       - filter: Background Check
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         function absolute threshold:
         - name: ObsErrorBound@DerivedMetaData
           channels: *atms_npp_channels
         actions:
           - name: set
             flag: GrossCheck
             ignore: rejected observations
           - name: reject

       # Step 11: Inter-Channel Check
       - filter: Bounds Check
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         test variables:
         - name: InterChannelConsistencyCheck@ObsFunction
           channels: *atms_npp_channels
           options:
             channels: *atms_npp_channels
             use passive_bc: true
             sensor: atms_npp
             use_flag: [ 1,  1,  1,  1,  1,
                         1,  1,  1,  1,  1,
                         1,  1,  1,  1,  4,
                         1,  1,  1,  1,  1,
                         1,  1]
         maxvalue: 1.0e-12
         actions:
           - name: set
             flag: InterChannelConsistency
             ignore: rejected observations
           - name: reject

       # Step 12: Useflag Check
       - filter: Bounds Check
         filter variables:
         - name: brightnessTemperature
           channels: *atms_npp_channels
         test variables:
         - name: ObsFunction/ChannelUseflagCheckRad
           channels: *atms_npp_channels
           options:
             channels: *atms_npp_channels
             use_flag: [ 1,  1,  1,  1,  1,
                         1,  1,  1,  1,  1,
                         1,  1,  1,  1,  4,
                         1,  1,  1,  1,  1,
                         1,  1]
         minvalue: 1.0e-12
         actions:
           - name: set
             flag: UseflagCheck
             ignore: rejected observations
           - name: reject




test:
  reference filename: testoutput/rrfs-mpasjedi-ens3dvar.ref
  test output filename: ./rrfs-mpasjedi-ens3dvar.out
  float relative tolerance: 1.0e-3
  float absolute tolerance: 1.0e-6
